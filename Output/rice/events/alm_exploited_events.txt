namespace = almexploited

planet_event = {
	id = almexploited.2
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		from = {
			has_building = building_garden_construction
		}
	}
	
	immediate = {
		from = {
			while = {
				limit = {
					has_resource = {
						type = sr_biomass
						amount > 0
					}
				}
				add_resource = {
					resource = sr_biomass
					amount = -1
				}
			}
			remove_building = yes
			set_building = building_garden_completed
		}
	}
}

planet_event = {
	id = almexploited.1
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		from = {
			has_building = building_biomass_furnace
		}
	}
	
	immediate = {
		from = {
			if = {
				limit = {
					has_resource = {
						type = sr_biomass
						amount = 1
					}
				}
				add_resource = {
					resource = sr_biomass
					amount = -1
				}
				add_resource = {
					resource = energy
					amount = 1
				}
			}
			if = {
				limit = {
					has_resource = {
						type = sr_biomass
						amount = 2
					}
				}
				add_resource = {
					resource = sr_biomass
					amount = -2
				}
				add_resource = {
					resource = energy
					amount = 2
				}
			}
			if = {
				limit = {
					has_resource = {
						type = sr_biomass
						amount = 3
					}
				}
				add_resource = {
					resource = sr_biomass
					amount = -3
				}
				add_resource = {
					resource = energy
					amount = 3
				}
			}
			if = {
				limit = {
					has_resource = {
						type = sr_biomass
						amount = 4
					}
				}
				add_resource = {
					resource = sr_biomass
					amount = -4
				}
				add_resource = {
					resource = energy
					amount = 4
				}
			}
			if = {
				limit = {
					has_resource = {
						type = sr_biomass
						amount > 4
					}
				}
				add_resource = {
					resource = sr_biomass
					amount = -5
				}
				add_resource = {
					resource = energy
					amount = 5
				}
			}
			if = {
				limit = {
					has_resource = {
						type = food
						amount = 1
					}
				}
				add_resource = {
					resource = food
					amount = -1
				}
				add_resource = {
					resource = energy
					amount = 1
				}
			}
			if = {
				limit = {
					has_resource = {
						type = food
						amount = 2
					}
				}
				add_resource = {
					resource = food
					amount = -2
				}
				add_resource = {
					resource = energy
					amount = 2
				}
			}
			if = {
				limit = {
					has_resource = {
						type = food
						amount = 3
					}
				}
				add_resource = {
					resource = food
					amount = -3
				}
				add_resource = {
					resource = energy
					amount = 3
				}
			}
			if = {
				limit = {
					has_resource = {
						type = food
						amount = 4
					}
				}
				add_resource = {
					resource = food
					amount = -4
				}
				add_resource = {
					resource = energy
					amount = 4
				}
			}
			if = {
				limit = {
					has_resource = {
						type = food
						amount > 4
					}
				}
				add_resource = {
					resource = food
					amount = -5
				}
				add_resource = {
					resource = energy
					amount = 5
				}
			}
			remove_building = yes
			set_building = building_biomass_furnace_actual
		}
	}
}

planet_event = {
	id = almexploited.100
	hide_window = yes
	
	trigger = {
		has_planet_flag = pf_processing_ice
		NOT = { has_planet_flag = pf_coastal_flooding }
		NOT = { has_planet_flag = pf_anti_flooding_check_spam }
		NOT = { has_planet_flag = pf_submerged_land }
		NOT = { has_planet_flag = pf_anti_submerged_land_check_spam }
		NOT = { has_modifier = coastal_flooding }
		NOT = { has_modifier = submerged_land }
		NOT = { is_planet_class = pc_ocean }
		NOT = { is_planet_class = pc_barren }
		NOT = { is_planet_class = pc_asteroid }
	}
	
	mean_time_to_happen = {
		months = 12
	}
	
	immediate = {
		if = {
			limit = {
				has_planet_flag = pf_processing_ice
			}
			random_list = {
				95 = {
					set_timed_planet_flag = {
						flag = pf_anti_flooding_check_spam
						days = 355
					}
				}
				5 = {
					set_planet_flag = pf_coastal_flooding
					owner = {
						country_event = { id = almexploited.110 }
					}
				}
			}
			else = {
				set_timed_planet_flag = {
					flag = pf_anti_flooding_check_spam
					days = 355
				}			
			}
		}
	}
}

# Coastal Flooding
country_event = {
	id = almexploited.110
	title = "almexploited.110.name"
	desc = "almexploited.110.desc"
	picture = GFX_evt_ocean
	show_sound = event_air_raid_siren
	location = FROM
	
	is_triggered_only = yes
	
	immediate = {
		hidden_effect = {
			FROM = {
				add_modifier = {
					modifier = coastal_flooding
					days = -1
				}
			}
		}	
	}
	
	option = {
		name = "almexploited.110.a"
		hidden_effect = {
			from = {
				remove_modifier = coastal_flooding
				remove_planet_flag = pf_coastal_flooding
				remove_planet_flag = pf_processing_ice
				planet_event = { id = manage_trade.2400 }
				random_list = {
					15 = {
						add_modifier = {
							modifier = coastal_flooding
							days = 360
						}					
					}
					35 = {
						add_modifier = {
							modifier = coastal_flooding
							days = 180
						}					
					}
					50 = {
						add_modifier = {
							modifier = coastal_flooding
							days = 90
						}					
					}			
				}				
			}
		}
	}
	option = {
		name = "almexploited.110.b"
		hidden_effect = {
			from = {
				set_planet_flag = pf_allow_coastal_flooding
			}
		}
	}
}

planet_event = {
	id = almexploited.200
	hide_window = yes
	
	trigger = {
		has_planet_flag = pf_processing_water
		NOT = { has_planet_flag = pf_global_freezing }
		NOT = { has_planet_flag = pf_anti_freezing_check_spam }
		NOT = { has_planet_flag = pf_new_ice_age }
		NOT = { has_planet_flag = pf_anti_iceage_check_spam }
		NOT = { has_modifier = global_freezing }
		NOT = { has_modifier = new_ice_age }
		NOT = { is_planet_class = pc_arctic }
		NOT = { is_planet_class = pc_barren }
		NOT = { is_planet_class = pc_asteroid }
	}
	
	mean_time_to_happen = {
		months = 24
	}
	
	immediate = {
		if = {
			limit = {
				has_planet_flag = pf_processing_water
			}
			random_list = {
				95 = {
					set_timed_planet_flag = {
						flag = pf_anti_freezing_check_spam
						days = 350
					}
				}
				5 = {
					set_planet_flag = pf_global_freezing
					owner = {
						country_event = { id = almexploited.210 }
					}
				}
			}
			else = {
				set_timed_planet_flag = {
					flag = pf_anti_freezing_check_spam
					days = 350
				}			
			}
		}
	}
}

# Global Freezing
country_event = {
	id = almexploited.210
	title = "almexploited.210.name"
	desc = "almexploited.210.desc"
	picture = GFX_evt_arctic
	show_sound = event_air_raid_siren
	location = FROM
	
	is_triggered_only = yes
	
	immediate = {
		hidden_effect = {
			FROM = {
				add_modifier = {
					modifier = global_freezing
					days = -1
				}
			}
		}	
	}
	
	option = {
		name = "almexploited.210.a"
		hidden_effect = {
			from = {
				remove_modifier = global_freezing
				remove_planet_flag = pf_global_freezing
				remove_planet_flag = pf_processing_water
				planet_event = { id = manage_trade.2200 }
				random_list = {
					15 = {
						add_modifier = {
							modifier = global_freezing
							days = 1800
						}					
					}
					35 = {
						add_modifier = {
							modifier = global_freezing
							days = 720
						}					
					}
					50 = {
						add_modifier = {
							modifier = global_freezing
							days = 360
						}					
					}			
				}				
			}
		}
	}
	option = {
		name = "almexploited.210.b"
		hidden_effect = {
			from = {
				set_planet_flag = pf_allow_global_freezing
			}
		}
	}
}